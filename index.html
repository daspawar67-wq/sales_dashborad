<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sales Lead Management Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
    /* ================= ROOT VARIABLES ================= */
:root {
  --primary: #2563eb;
  --primary-dark: #1d4ed8;
  --secondary: #7c3aed;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --info: #06b6d4;

  --gray-50: #f8fafc;
  --gray-100: #f1f5f9;
  --gray-200: #e2e8f0;
  --gray-300: #cbd5e1;
  --gray-400: #94a3b8;
  --gray-500: #64748b;
  --gray-600: #475569;
  --gray-700: #334155;
  --gray-800: #1e293b;
  --gray-900: #0f172a;

  --black-50: #f8fafc;
  --black-700: #334155;

  --radius: 16px;
  --radius-sm: 8px;

  --shadow-sm: 0 1px 2px rgb(0 0 0 / 6%);
  --shadow-md: 0 4px 8px rgb(0 0 0 / 8%);
  --shadow-lg: 0 10px 20px rgb(0 0 0 / 10%);

  --transition: all 0.25s ease;
}

/* ================= RESET ================= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Inter", system-ui, sans-serif;
  background: linear-gradient(135deg, #f8fafc, #e2e8f0);
  color: var(--gray-800);
  min-height: 100vh;
}

/* ================= HEADER ================= */
.dashboard-header {
  background: white;
  padding: 24px 0;
  margin-bottom: 24px;
  box-shadow: var(--shadow-sm);
  border-bottom: 1px solid var(--gray-200);
}

.dashboard-title {
  text-align: center;
  font-size: 2.2rem;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* ================= ACTION BAR ================= */
.action-bar {
  background: white;
  padding: 20px;
  border-radius: var(--radius);
  display: flex;
  flex-wrap: wrap;
  gap: 14px;
  margin-bottom: 28px;
  box-shadow: var(--shadow-md);
}

.form-control-modern {
  flex: 1;
  min-width: 240px;
  padding: 12px 14px;
  font-size: 14px;
  border-radius: var(--radius-sm);
  border: 2px solid var(--gray-200);
}

.form-control-modern:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(37,99,235,.15);
}

/* ================= BUTTONS ================= */
.btn-modern {
  padding: 12px 20px;
  border-radius: var(--radius-sm);
  font-size: 14px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  border: none;
  cursor: pointer;
  transition: var(--transition);
}

.btn-modern:active {
  transform: scale(.96);
}

.btn-primary-modern {
  background: var(--primary);
  color: #fff;
}

.btn-primary-modern:hover {
  background: var(--primary-dark);
}

.btn-success-modern {
  background: var(--success);
  color: #fff;
}

.btn-success-modern:hover {
  background: #059669;
}

/* ================= CAROUSEL ================= */
.carousel-container {
  background: white;
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow-md);
  margin-bottom: 32px;
}

.carousel-control-prev,
.carousel-control-next {
  display: none !important;
}

/* ================= INDICATORS ================= */
.carousel-indicators-custom {
  display: flex;
  justify-content: center;
  gap: 8px;
  padding: 16px;
  background: var(--gray-50);
}

.indicator-dot {
  width: 40px;
  height: 6px;
  background: var(--gray-300);
  border-radius: 4px;
  border: none;
  cursor: pointer;
  opacity: .6;
  transition: var(--transition);
}

.indicator-dot.active {
  background: var(--primary);
  opacity: 1;
  width: 56px;
}

/* ================= CARDS ================= */
.dashboard-card {
  background: white;
}

.card-header-custom {
  padding: 18px 22px;
  font-size: 1.1rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: #fff;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-body-custom {
  padding: 26px 22px;
}

/* ================= TABLE ================= */
.table-container {
  overflow-x: auto;
  border-radius: var(--radius-sm);
  border: 1px solid var(--gray-200);
}

.table-modern {
  width: 100%;
  border-collapse: collapse;
}

.table-modern thead th {
  background: var(--gray-100);
  color: var(--gray-700);
  font-size: 20px;
  font-weight: 700;
  text-transform: uppercase;
  padding: 14px 8px;
  border-bottom: 2px solid var(--gray-200);
  text-align: center;
}

.table-modern td {
  padding: 12px 8px;
  font-size: 20px;
  text-align: center;
  border-bottom: 1px solid var(--gray-100);
}

.table-modern tbody tr:hover {
  background: #f9fafb;
}

/* ================= STICKY NAME COLUMN ================= */
.name-cell {
  position: sticky;
  left: 0;
  z-index: 2;
  background: linear-gradient(90deg, #f8fafc, #fff);
  text-align: left !important;
  padding-left: 14px !important;
  font-weight: 600;
  
}

/* ================= EDITABLE ================= */
.editable-cell {
  cursor: pointer;
}

.editable-cell:hover {
  background: rgba(37,99,235,.08);
}

/* ================= INPUT ================= */
.input-number {
  width: 70px;
  padding: 6px 8px;
  font-size: 20px;
  border-radius: var(--radius-sm);
  border: 2px solid var(--gray-200);
}

.input-number:focus {
  outline: none;
  border-color: var(--primary);
}

/* ================= TOTAL / FOOTER ================= */
.total-cell {
  font-weight: 700;
  color: var(--primary);
}

.table-footer td {
  background: var(--gray-50);
  font-weight: 700;
  border-top: 2px solid var(--gray-200);
}

/* ================= LOADING ================= */
.loading-overlay {
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,.92);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.spinner-modern {
  width: 46px;
  height: 46px;
  border: 4px solid var(--gray-300);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ================= NOTIFICATION ================= */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  min-width: 280px;
  padding: 14px 18px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  gap: 10px;
  color: #fff;
  box-shadow: var(--shadow-lg);
  z-index: 10000;
}

.notification-success { background: var(--success); }
.notification-error   { background: var(--danger); }
.notification-warning { background: var(--warning); }

/* ================= SCROLLBAR ================= */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-thumb {
  background: var(--gray-400);
  border-radius: 6px;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
  .dashboard-title {
    font-size: 1.6rem;
  }

  .table-modern td,
  .table-modern th {
    font-size: 12px;
    padding: 8px 6px;
  }

  .input-number {
    width: 58px;
  }
}
.carousel-item {
  transition: transform 2s ease;
}

</style>
  </head>
  <body>
    <div class="loading-overlay" id="loadingOverlay" style="display: none">
      <div class="spinner-modern"></div>
    </div>
    <div class="dashboard-header">
      <div class="container-fluid">
        <h1 class="dashboard-title">Sales Lead Management Dashboard</h1>
      </div>
    </div>
    <div class="container-fluid">
      <!-- <div class="action-bar">
        <input
          type="text"
          id="newEmployee"
          class="form-control-modern"
          placeholder="Enter employee name..."
        />
        <button
          class="btn-modern btn-success-modern"
          onclick="addSalesEmployee()"
        >
          <i class="bi bi-person-plus"></i> Add Employee
        </button>
        <button class="btn-modern btn-primary-modern" onclick="saveAllData()">
          <i class="bi bi-cloud-arrow-up"></i> Save All Data
        </button>
      </div> -->
      <div class="carousel-container">
<div id="salesCarousel"
     class="carousel slide"
     data-bs-ride="carousel"
     data-bs-interval="20000"
     data-bs-pause="hover"
     data-bs-touch="true">



          <div class="carousel-indicators-custom">
            <button
              class="indicator-dot active"
              data-bs-target="#salesCarousel"
              data-bs-slide-to="0"
            ></button>
            <button
              class="indicator-dot"
              data-bs-target="#salesCarousel"
              data-bs-slide-to="1"
            ></button>
            <button
              class="indicator-dot"
              data-bs-target="#salesCarousel"
              data-bs-slide-to="2"
            ></button>
            <button
              class="indicator-dot"
              data-bs-target="#salesCarousel"
              data-bs-slide-to="3"
            ></button>
            <button
              class="indicator-dot"
              data-bs-target="#salesCarousel"
              data-bs-slide-to="4"
            ></button>
          </div>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <div class="dashboard-card">
                <div class="card-header-custom">
                  <i class="bi bi-calendar3"></i> Daily Performance Board
                </div>
                <div class="card-body-custom">
                  <div class="d-flex justify-content-center mb-4">
                    <select
                      id="monthSelect"
                      class="select-modern"
                      onchange="renderDaily()"
                    >
                      <option value="0">January</option>
                      <option value="1">February</option>
                      <option value="2">March</option>
                      <option value="3">April</option>
                      <option value="4">May</option>
                      <option value="5">June</option>
                      <option value="6">July</option>
                      <option value="7">August</option>
                      <option value="8">September</option>
                      <option value="9">October</option>
                      <option value="10">November</option>
                      <option value="11">December</option>
                    </select>
                  </div>
                  <div class="table-container">
                    <table class="table-modern">
                      <thead>
                        <tr id="dailyHead"></tr>
                      </thead>
                      <tbody id="dailyBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="carousel-item">
              <div class="dashboard-card">
                <div class="card-header-custom">
                  <i class="bi bi-graph-up-arrow"></i> Webinar Performance
                  Summary
                </div>
                <div class="card-body-custom">
                  <div class="table-container">
                    <table class="table-modern">
                      <thead>
                        <tr>
                          <th>Team Member</th>
                          <th>FRE</th>
                          <th>OFF</th>
                          <th>REP</th>
                          <th>FAM</th>
                          <th>TOTAL</th>
                        </tr>
                      </thead>
                      <tbody id="summaryBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="carousel-item">
              <div class="dashboard-card">
                <div class="card-header-custom">
                  <i class="bi bi-calendar-month"></i> Monthly Performance
                  Metrics
                </div>
                <div class="card-body-custom">
                  <div class="table-container">
                    <table class="table-modern">
                      <thead>
                        <tr>
                          <th>Team Member</th>
                          <th>Jan</th>
                          <th>Feb</th>
                          <th>Mar</th>
                          <th>Apr</th>
                          <th>May</th>
                          <th>Jun</th>
                          <th>Jul</th>
                          <th>Aug</th>
                          <th>Sep</th>
                          <th>Oct</th>
                          <th>Nov</th>
                          <th>Dec</th>
                        </tr>
                      </thead>
                      <tbody id="monthlyBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="carousel-item">
              <div class="dashboard-card">
                <div class="card-header-custom">
                  <i class="bi bi-people"></i> Batch Lead Distribution
                </div>
                <div class="card-body-custom">
                  <div class="table-container">
                    <table class="table-modern">
                      <thead>
                        <tr id="batchHead">
                          <th>Team Member</th>
                        </tr>
                      </thead>
                      <tbody id="batchBody"></tbody>
                      <tfoot id="batchFooter" class="table-footer"></tfoot>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="carousel-item">
              <div class="dashboard-card">
                <div class="card-header-custom">
                  <i class="bi bi-calendar-range"></i> Monthly Batch â€“ Admin
                  Lead Entry
                </div>
                <div class="card-body-custom">
                  <div class="table-container">
                    <table class="table-modern">
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>10 Jul</th>
                          <th>29 Jul</th>
                          <th>Jul Lead</th>
                          <th>19 Aug</th>
                          <th>Aug Lead</th>
                          <th>16 Sep</th>
                          <th>Sep Lead</th>
                          <th>13 Oct</th>
                          <th>Oct Lead</th>
                          <th>10 Nov</th>
                          <th>20 Nov</th>
                          <th>Nov Lead</th>
                          <th>14 Dec</th>
                          <th>Dec Lead</th>
                          <th>Jan Lead</th>
                        </tr>
                      </thead>
                      <tbody id="batchTableBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      /* ================= SALES DASHBOARD ================= */
      // IMPORTANT: Use a relative path for single-service deployment
      const API_URL = "https://tables-h7u9.onrender.com/api";

      let salesData = {
        employees: [],
        dailyBookings: {},
        leadSummary: {},
        monthlyLeads: {},
      };
      let batchData = { employees: [], batches: [], batchLeads: {}, thc: {} };
      let monthlyBatchData = []; // This will be an array of objects: [{name: '...', leads: [..]}]

      function showLoading() {
        document.getElementById("loadingOverlay").style.display = "flex";
      }
      function hideLoading() {
        document.getElementById("loadingOverlay").style.display = "none";
      }
      function showNotification(message, type = "success") {
        const notification = document.createElement("div");
        notification.className = `notification notification-${type} fade-in`;
        notification.innerHTML = `<i class="bi bi-${type === "success" ? "check-circle" : type === "error" ? "x-circle" : "info-circle"}"></i><span>${message}</span>`;
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.style.animation = "slideIn 0.3s ease-out reverse";
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      async function fetchData() {
        try {
          showLoading();
          const response = await fetch(`${API_URL}/sales`);
          if (!response.ok) throw new Error("Network response was not ok");
          const data = await response.json();
          salesData = {
            employees: data.employees || [],
            dailyBookings: data.dailyBookings || {},
            leadSummary: data.leadSummary || {},
            monthlyLeads: data.monthlyLeads || {},
          };
          batchData = data.batchData || {
            employees: [],
            batches: [],
            batchLeads: {},
            thc: {},
          };

          // UPDATED: Process monthly batch admin data with 15 elements
          monthlyBatchData = [];
          if (data.monthlyBatchAdmin) {
            for (const name in data.monthlyBatchAdmin) {
              const leadsArray = data.monthlyBatchAdmin[name];
              // Ensure the array has 15 elements, padding with 0s if necessary
              const paddedLeads = Array(15).fill(0).map((_, i) => leadsArray[i] || 0);
              monthlyBatchData.push({ name, leads: paddedLeads });
            }
          }
          renderAll();
        } catch (error) {
          console.error("Error fetching data:", error);
          showNotification("Failed to load data.", "error");
        } finally {
          hideLoading();
        }
      }

      async function saveAllData() {
        try {
          showLoading();
          const response = await fetch(`${API_URL}/sales`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              employees: salesData.employees,
              dailyBookings: salesData.dailyBookings,
              leadSummary: salesData.leadSummary,
              monthlyLeads: salesData.monthlyLeads,
              batchData: batchData,
              monthlyBatchAdmin: monthlyBatchData,
            }),
          });
          if (response.ok) {
            showNotification("Data saved successfully!", "success");
          } else {
            throw new Error("Failed to save data");
          }
        } catch (error) {
          console.error("Error saving data:", error);
          showNotification("Failed to save data. Please try again.", "error");
        } finally {
          hideLoading();
        }
      }

      async function addSalesEmployee() {
        const name = document.getElementById("newEmployee").value.trim();
        if (!name) {
          showNotification("Please enter an employee name", "warning");
          return;
        }
        if (salesData.employees.includes(name)) {
          showNotification("Employee already exists!", "warning");
          return;
        }
        try {
          showLoading();
          const response = await fetch(`${API_URL}/employee`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name }),
          });
          if (response.ok) {
            salesData.employees.push(name);
            salesData.dailyBookings[name] = {};
            salesData.leadSummary[name] = { pre: 0, off: 0, rep: 0, app: 0 };
            salesData.monthlyLeads[name] = Array(12).fill(0);
            batchData.employees.push(name);
            batchData.batchLeads[name] = {};
            batchData.batches.forEach(
              (b) => (batchData.batchLeads[name][b.id] = 0),
            );
            document.getElementById("newEmployee").value = "";
            renderAll();
            showNotification(`${name} added successfully!`, "success");
          } else {
            throw new Error("Failed to add employee");
          }
        } catch (error) {
          console.error("Error adding employee:", error);
          showNotification(
            "Failed to add employee. Please try again.",
            "error",
          );
        } finally {
          hideLoading();
        }
      }

      // --- Render Functions (mostly unchanged) ---
      function daysInMonth(month) {
        return new Date(new Date().getFullYear(), month + 1, 0).getDate();
      }
      function renderDaily() {
        const month = +monthSelect.value;
        const days = daysInMonth(month);
        dailyHead.innerHTML = `<th class="name-cell">Team Member</th>`;
        for (let d = 1; d <= days; d++) dailyHead.innerHTML += `<th>${d}</th>`;
        dailyHead.innerHTML += `<th class="total-cell">TOTAL</th>`;
        dailyBody.innerHTML = "";
        salesData.employees.forEach((emp) => {
          if (!salesData.dailyBookings[emp][month])
            salesData.dailyBookings[emp][month] = {};
          let total = 0;
          let row = `<tr><td class="name-cell">${emp}</td>`;
          for (let d = 1; d <= days; d++) {
            const val = salesData.dailyBookings[emp][month][d] || "";
            total += Number(val || 0);
            row += `<td class="editable-cell" contenteditable onblur="updateDaily('${emp}',${month},${d},this.innerText)">${val}</td>`;
          }
          row += `<td class="total-cell">${total}</td></tr>`;
          dailyBody.innerHTML += row;
        });
      }
      function updateDaily(emp, m, d, val) {
        salesData.dailyBookings[emp][m][d] = Number(val) || 0;
        autoMonthly();
        renderDaily();
      }
      function autoMonthly() {
        salesData.employees.forEach((emp) => {
          for (let m = 0; m < 12; m++) {
            let sum = 0;
            if (salesData.dailyBookings[emp][m])
              Object.values(salesData.dailyBookings[emp][m]).forEach(
                (v) => (sum += Number(v || 0)),
              );
            salesData.monthlyLeads[emp][m] = sum;
          }
        });
        renderMonthly();
      }
      function renderSummary() {
        summaryBody.innerHTML = "";
        salesData.employees.forEach((emp) => {
          const s = salesData.leadSummary[emp];
          const t = s.pre + s.off + s.rep + s.app;
          summaryBody.innerHTML += `<tr><td class="name-cell">${emp}</td><td><input type="number" class="input-number" value="${s.pre}" onchange="sUpdate('${emp}','pre',this.value)"></td><td><input type="number" class="input-number" value="${s.off}" onchange="sUpdate('${emp}','off',this.value)"></td><td><input type="number" class="input-number" value="${s.rep}" onchange="sUpdate('${emp}','rep',this.value)"></td><td><input type="number" class="input-number" value="${s.app}" onchange="sUpdate('${emp}','app',this.value)"></td><td class="total-cell">${t}</td></tr>`;
        });
      }
      function sUpdate(emp, k, v) {
        salesData.leadSummary[emp][k] = Number(v) || 0;
        renderSummary();
      }
      function renderMonthly() {
        monthlyBody.innerHTML = "";
        salesData.employees.forEach((emp) => {
          let row = `<tr><td class="name-cell">${emp}</td>`;
          salesData.monthlyLeads[emp].forEach(
            (v) => (row += `<td><b>${v}</b></td>`),
          );
          monthlyBody.innerHTML += row + "</tr>";
        });
      }
      function renderBatch() {
        batchHead.innerHTML = "<th>Team Member</th>";
        batchBody.innerHTML = "";
        batchFooter.innerHTML = "";
        batchData.batches.forEach(
          (b) => (batchHead.innerHTML += `<th>${b.label}</th>`),
        );
        batchData.employees.forEach((emp) => {
          let row = `<tr><td class="name-cell">${emp}</td>`;
          batchData.batches.forEach((b) => {
            row += `<td class="editable-cell" contenteditable onblur="updateBatch('${emp}',${b.id},this.innerText)">${batchData.batchLeads[emp][b.id]}</td>`;
          });
          batchBody.innerHTML += row + "</tr>";
        });
        let totalRow = `<tr><td class="name-cell">TOTAL</td>`;
        batchData.batches.forEach((b) => {
          let sum = 0;
          batchData.employees.forEach(
            (e) => (sum += Number(batchData.batchLeads[e][b.id] || 0)),
          );
          totalRow += `<td class="total-cell">${sum}</td>`;
        });
        let thcRow = `<tr><td class="name-cell">T.H.C</td>`;
        batchData.batches.forEach((b) => {
          thcRow += `<td class="editable-cell" contenteditable onblur="updateTHC(${b.id},this.innerText)">${batchData.thc[b.id]}</td>`;
        });
        batchFooter.innerHTML = totalRow + "</tr>" + thcRow + "</tr>";
      }
      function updateBatch(emp, id, v) {
        batchData.batchLeads[emp][id] = Number(v) || 0;
        renderBatch();
      }
      function updateTHC(id, v) {
        batchData.thc[id] = Number(v) || 0;
        renderBatch();
      }

      // --- UPDATED Monthly Batch Admin Functions ---
      function addBatchEmployee() {
        const name = document.getElementById("batchEmpName").value.trim();
        if (!name) {
          showNotification("Enter employee name", "warning");
          return;
        }
        if (monthlyBatchData.some((e) => e.name === name)) {
          showNotification("Employee already exists in this table!", "warning");
          return;
        }
        // UPDATED: Create an array with 15 elements
        monthlyBatchData.push({ name: name, leads: Array(15).fill(0) });
        document.getElementById("batchEmpName").value = "";
        renderBatchTable();
        showNotification(
          `${name} added! Click 'Save All Data' to persist.`,
          "success",
        );
      }
      function updateBatchLead(empIndex, leadIndex, value) {
        monthlyBatchData[empIndex].leads[leadIndex] = Number(value) || 0;
      }
      function renderBatchTable() {
        const body = document.getElementById("batchTableBody");
        body.innerHTML = "";
        monthlyBatchData.forEach((emp, i) => {
          let row = `<tr><td class="name-cell">${emp.name}</td>`;
          // The loop will now correctly render 15 input fields
          emp.leads.forEach((val, j) => {
            row += `<td><input type="number" class="input-number" value="${val}" onchange="updateBatchLead(${i}, ${j}, this.value)"></td>`;
          });
          row += "</tr>";
          body.innerHTML += row;
        });
      }

      function renderAll() {
        renderDaily();
        renderSummary();
        renderMonthly();
        renderBatch();
        renderBatchTable();
      }
      document.addEventListener("DOMContentLoaded", fetchData);
    </script>
  </body>
</html>
